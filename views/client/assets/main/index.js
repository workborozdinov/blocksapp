window.__require=function e(t,n,i){function o(r,c){if(!n[r]){if(!t[r]){var s=r.split("/");if(s=s[s.length-1],!t[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){return o(t[r][1][e]||e)},l,l.exports,e,t,n,i)}return n[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)o(i[r]);return o}({AvailablePositionsHelper:[function(e,t){"use strict";cc._RF.push(t,"b6b74fa44VDXYuxG9zQdBFh","AvailablePositionsHelper"),cc.Class({properties:{positionCenterInWorld:cc.v2(),arrIndex:[]}}),cc._RF.pop()},{}],CellGameField:[function(e,t){"use strict";cc._RF.push(t,"a8aef+qqHxLL4c5ozVM9sTd","CellGameField"),cc.Class({extends:cc.Component,properties:{shadowBlock:{default:null,type:cc.Node},attachedNode:{default:null,type:cc.Node,visible:!1}},toggleShadowBlock:function(e){this.shadowBlock.active=e}}),cc._RF.pop()},{}],CellGridPlayer:[function(e,t){"use strict";cc._RF.push(t,"57baaUrdCxIbJnoFI4UevX3","CellGridPlayer"),cc.Class({extends:cc.Component,properties:{renderNode:{default:null,type:cc.Node},attachedNode:{default:null,type:cc.Node}}}),cc._RF.pop()},{}],Cell:[function(e,t){"use strict";cc._RF.push(t,"dd9eeVMruhC8bu6P/iUNPmT","Cell"),cc.Class({extends:cc.Component,properties:{renderNode:{default:null,type:cc.Node},isBusy:{default:!1,notify:function(){this.renderNode.opacity=255*this.isBusy}}}}),cc._RF.pop()},{}],DataDictionary:[function(e,t){"use strict";cc._RF.push(t,"8bacaIc0xxD7L2RC2wQamct","DataDictionary");var n,i=(n=e("DataType"))&&n.__esModule?n:{default:n},o=e("GameEvent");cc.Class({extends:cc.Component,properties:{PREVIEW:{default:!1,editorOnly:!0},dataType:{default:i.default.None,type:i.default,notify:function(){-1===this._convertDataType.indexOf(this.dataType)&&(this._convertDataType.push(this.dataType),this._data.push(null)),this.data=this._data[this._convertDataType.indexOf(this.dataType)]}},data:{default:null,type:cc.JsonAsset,notify:function(){this.dataType===i.default.None||null!==this.data&&!this.data||(this._data[this._convertDataType.indexOf(this.dataType)]=this.data)},visible:function(){return this.dataType!==i.default.None}},convertDataType:{get:function(){return this._convertDataType},type:[i.default],visible:function(){return this.PREVIEW}},_convertDataType:{default:function(){return[i.default.None]},type:[i.default]},_data:{default:function(){return[null]},type:[cc.JsonAsset]}},onLoad:function(){this._subscribeEvents(!0)},_subscribeEvents:function(e){var t=e?"on":"off";cc.systemEvent[t](o.GameEvent.GET_DATA,this.onGetData,this)},_getData:function(e){var t=this._convertDataType.indexOf(e);return-1!==t?this._data[t]:null},onGetData:function(e,t){var n=this._getData(e);t instanceof Function&&t(n)}}),cc._RF.pop()},{DataType:"DataType",GameEvent:"GameEvent"}],DataType:[function(e,t,n){"use strict";cc._RF.push(t,"1a8f4Kc8wxOE7veGVvJCjLp","DataType"),n.__esModule=!0,n.default=void 0;var i=cc.Enum({None:0,PuzzleGridData:1,GameFieldCombinations:2});n.default=i,t.exports=n.default,cc._RF.pop()},{}],EnemyField:[function(e,t){"use strict";cc._RF.push(t,"88071g2vXRC0IirXxrPovVj","EnemyField");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{cellPrefab:{default:null,type:cc.Prefab},_gridSize:cc.v2(9,9),_cellSize:new cc.Size(100,100),_dividerSize:5,_grid:[],arrayPossiblePosition:[]},onEnable:function(){this._createGrid(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](n.GameEvent.UPDATE_ENEMY_GRID,this.onUpdateEnemyGrid,this)},_createGrid:function(){this._grid=[];for(var e=0;e<this._gridSize.x;e++){this._grid.push([]);for(var t=0;t<this._gridSize.y;t++){var n=cc.instantiate(this.cellPrefab),i=n.getComponent("CellGridPlayer"),o=cc.v2(-this.node.width/2+t*n.width+n.width/2+t*this._dividerSize,this.node.height/2-e*n.height-n.height/2-e*this._dividerSize);n.parent=this.node,n.setPosition(o),this._grid[e].push(i)}}},onUpdateEnemyGrid:function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)e[t][n]?this._grid[t][n].renderNode.opacity=255:this._grid[t][n].renderNode.opacity=0}}),cc._RF.pop()},{GameEvent:"GameEvent"}],GameEvent:[function(e,t,n){"use strict";cc._RF.push(t,"8be8d8L+t9PdI9Pis312ZTx","GameEvent"),n.__esModule=!0,n.GameEvent=void 0;var i=cc.Enum({NONE:0,INPUT:1,GET_DATA:2,PUZZLE_CAPTURED:3,PUZZLE_RELEASED:4,PUZZLE_MOVE:5,CREATE_TARGET_PUZZLE:6,PUZZLE_PINNED:7,UPDATE_PLAYER_SCORE:100,UPDATE_ENEMY_SCORE:101,SET_PLAYER_NAME:200,SET_ENEMY_NAME:201,UPDATE_TIMER:301,GET_PUZZLES:401,SET_PUZZLES:402,UPDATE_PLAYER_GRID:501,UPDATE_ENEMY_GRID:502,MATCH_START:1001,MATCH_END:1002});n.GameEvent=i,cc._RF.pop()},{}],GameManager:[function(e,t){"use strict";cc._RF.push(t,"a4f1bk2Tw1MxJotUTosVzoU","GameManager");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{isEnableMultiTouch:!1,inputManager:{default:null,type:cc.Node}},onEnable:function(){this._init(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](n.GameEvent.MATCH_START,this.onMatchStart,this),cc.systemEvent[t](n.GameEvent.MATCH_END,this.onMatchEnd,this)},_init:function(){cc.macro.ENABLE_MULTI_TOUCH=this.isEnableMultiTouch},onMatchStart:function(){cc.log("start"),this.inputManager.active=!0},onMatchEnd:function(){cc.log("end"),this.inputManager.active=!1}}),cc._RF.pop()},{GameEvent:"GameEvent"}],IInputCommand:[function(e,t,n){"use strict";cc._RF.push(t,"a776431k/NCb70A4/vHibe9","IInputCommand"),n.__esModule=!0,n.default=void 0;var i=function(){function e(e){this.node=e.node,this.manager=e,this.touches=e.touches,this._currentTouch=null}var t=e.prototype;return t.onDown=function(){},t.onMove=function(){},t.onUp=function(){},t.createTouchInfo=function(e,t){var n={id:e._id,down:this.getTouchInfo(e,t),last:this.getTouchInfo(e,t),current:this.getTouchInfo(e,t)},i=this.touches.indexOf(null);return-1===i&&(i=this.touches.length,this.touches.push(null)),e.__id=i,this.touches[i]=n,n},t.refreshTouchInfo=function(e,t,n){e.last=e.current,e.current=this.getTouchInfo(t,n)},t.findTouch=function(e){return this.touches[e.__id]},t.destroyTouch=function(e){this.touches[e.__id]=null},t.getTouchInfo=function(e){var t=e.getLocation(),n=t.clone(),i=cc.Camera.main.getScreenToWorldPoint(e.getLocation());return n=this.node.convertToNodeSpaceAR(i),{time:this.manager.time,location:t,position:n,worldPosition:i}},e}();n.default=i,t.exports=n.default,cc._RF.pop()},{}],InputCatcher:[function(e,t){"use strict";cc._RF.push(t,"81046i4gF1AmYsU/Ln73WAB","InputCatcher");var n=e("GameEvent"),i=a(e("InputDirection")),o=a(e("InputType"));function a(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{direction:{default:i.default.None,type:i.default,tooltip:"\u043c\u0435\u0441\u0442\u043e \u043e\u0442\u043a\u0443\u0434\u0430 \u043f\u0440\u0438\u0448\u0435\u043b \u0438\u043d\u043f\u0443\u0442, \u043f\u043e \u044d\u043d\u0430\u043c\u0443 InputDirection"},target:{default:null,type:cc.Component,tooltip:"\u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u0430 \u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u0443. \u0412 \u043a\u043e\u043c\u0430\u043d\u0434\u0435 \u043c\u043e\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0435 \u043c\u0435\u0442\u043e\u0434\u044b"},analyticsArea:""},editor:{menu:"Input/InputCatcher"},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";this.node[t](cc.Node.EventType.TOUCH_START,this.onDown,this),this.node[t](cc.Node.EventType.TOUCH_MOVE,this.onMove,this),this.node[t](cc.Node.EventType.TOUCH_END,this.onUp,this),this.node[t](cc.Node.EventType.TOUCH_CANCEL,this.onUp,this)},onDown:function(e){cc.systemEvent.emit(n.GameEvent.INPUT,o.default.Down,this.direction,e.touch,this,this.target)},onMove:function(e){cc.systemEvent.emit(n.GameEvent.INPUT,o.default.Move,this.direction,e.touch,this,this.target)},onUp:function(e){cc.systemEvent.emit(n.GameEvent.INPUT,o.default.Up,this.direction,e.touch,this,this.target)}}),cc._RF.pop()},{GameEvent:"GameEvent",InputDirection:"InputDirection",InputType:"InputType"}],InputDirection:[function(e,t,n){"use strict";cc._RF.push(t,"0e72cf2IpJFD5WUnkNsAV5v","InputDirection"),n.__esModule=!0,n.default=void 0;var i=cc.Enum({None:0,Puzzle:1});n.default=i,t.exports=n.default,cc._RF.pop()},{}],InputManager:[function(e,t){"use strict";cc._RF.push(t,"1d252+ECVNH8pgkI9is40hr","InputManager");var n=e("GameEvent"),i=r(e("InputDirection")),o=r(e("InputType")),a=r(e("PuzzleInputCommand"));function r(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{commands:{default:{},visible:!1,serializable:!1},_isFirstTap:{default:!0,serializable:!1},_isInput:{default:!1,serializable:!1}},editor:{menu:"Input/InputManager"},onLoad:function(){this._handleSubscription(!0),this.commands[i.default.Puzzle]=new a.default(this)},_handleSubscription:function(){cc.systemEvent.on(n.GameEvent.INPUT,this.onInput,this)},onInput:function(e,t,n,i,a){var r=this.commands[t];switch(e){case o.default.Down:r&&r.onDown(n,i,a),this._isInput=!0;break;case o.default.Move:r&&r.onMove(n,i,a);break;case o.default.Up:r&&(r.onUp(n,i,a),this._isInput=!1)}},onDown:function(){},onMove:function(){},onUp:function(){}}),cc._RF.pop()},{GameEvent:"GameEvent",InputDirection:"InputDirection",InputType:"InputType",PuzzleInputCommand:"PuzzleInputCommand"}],InputType:[function(e,t,n){"use strict";cc._RF.push(t,"a55f9VtZXtG9asuWKjwRLgJ","InputType"),n.__esModule=!0,n.default=void 0;var i=cc.Enum({None:0,Down:1,Move:2,Up:3,Cancel:4});n.default=i,t.exports=n.default,cc._RF.pop()},{}],MessageType:[function(e,t,n){"use strict";cc._RF.push(t,"1cfd9ojXuJG7qkZA+aErSqD","MessageType"),n.__esModule=!0,n.MessageType=void 0,n.MessageType={Time:"time"},cc._RF.pop()},{}],NameController:[function(e,t){"use strict";cc._RF.push(t,"9fdb0fgxqdIN5PlrcUaPgCA","NameController");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{setEventName:{default:n.GameEvent.NONE,type:n.GameEvent},nameText:{default:null,type:cc.RichText}},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](this.setEventName,this.onSetName,this)},onSetName:function(e){this.nameText.string=e}}),cc._RF.pop()},{GameEvent:"GameEvent"}],NetworkManagerTS:[function(e,t,n){"use strict";cc._RF.push(t,"2a960quGthNbIsO4TKeIsVq","NetworkManagerTS");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,i){var o,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(r=(a<3?o(r):a>3?o(t,n,r):o(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function r(e){try{s(i.next(e))}catch(t){a(t)}}function c(e){try{s(i.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,c)}s((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(e){return function(t){return s([e,t])}}function s(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../Enums/GameEvent.js"),u=cc._decorator,l=u.ccclass,d=u.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hostName="localhost",t.port="3000",t}return o(t,e),t.prototype.start=function(){this.client=new WebSocket("ws://"+this.hostName+":"+this.port),this.connect(),this._handleSubscription(!0)},t.prototype.connect=function(){return r(this,void 0,void 0,function(){var e=this;return c(this,function(){return this.client.onopen=function(t){e.onOpen(t)},this.client.onmessage=function(t){e.onMessage(t)},this.client.onerror=function(t){e.onError(t)},this.client.onclose=function(t){e.onClose(t)},[2]})})},t.prototype._handleSubscription=function(e){var t=e?"on":"off";cc.systemEvent[t](s.GameEvent.GET_PUZZLES,this.onGetPuzzles,this),cc.systemEvent[t](s.GameEvent.UPDATE_PLAYER_GRID,this.onUpdatePlayerGrid,this),cc.systemEvent[t](s.GameEvent.UPDATE_PLAYER_SCORE,this.onUpdatePlayerScore,this)},t.prototype.onMessage=function(e){var t=JSON.parse(e.data),n=t.type,i=t.params;switch(n){case"time":this._updateTimer(i);break;case"match":this._changeStateMatch(i);break;case"puzzle":this._setPuzzles(i);break;case"grid":this._updateEnemyGrid(i);break;case"score":this._updateEnemyScore(i);break;default:console.warn("Type: "+n+" unknown")}},t.prototype.onError=function(e){console.log("error",e)},t.prototype.onClose=function(e){console.log("close",e)},t.prototype.onOpen=function(e){console.log("open",e)},t.prototype._changeStateMatch=function(e){e.start&&cc.systemEvent.emit(s.GameEvent.MATCH_START),e.end&&cc.systemEvent.emit(s.GameEvent.MATCH_END)},t.prototype._updateTimer=function(e){cc.systemEvent.emit(s.GameEvent.UPDATE_TIMER,e.time)},t.prototype._setPuzzles=function(e){cc.systemEvent.emit(s.GameEvent.SET_PUZZLES,e.array)},t.prototype._updateEnemyGrid=function(e){cc.systemEvent.emit(s.GameEvent.UPDATE_ENEMY_GRID,e.array)},t.prototype._updateEnemyScore=function(e){cc.systemEvent.emit(s.GameEvent.UPDATE_ENEMY_SCORE,e.points)},t.prototype.onGetPuzzles=function(e){if(void 0===e&&(e=3),this.client.readyState===WebSocket.OPEN){var t={type:"puzzle",params:{amount:e}};this.client.send(JSON.stringify(t))}else console.log("socket suck!!!")},t.prototype.onUpdatePlayerGrid=function(e){if(this.client.readyState===WebSocket.OPEN){var t={type:"grid",params:{array:e}};this.client.send(JSON.stringify(t))}else console.log("socket suck!!!")},t.prototype.onUpdatePlayerScore=function(e){if(this.client.readyState===WebSocket.OPEN){var t={type:"score",params:{points:e}};this.client.send(JSON.stringify(t))}else console.log("socket suck!!!")},a([d],t.prototype,"hostName",void 0),a([d],t.prototype,"port",void 0),a([l],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../Enums/GameEvent.js":"GameEvent"}],PlayerField:[function(e,t){"use strict";cc._RF.push(t,"7a3deOKTo9MC6cso2surHO+","PlayerField");var n=e("GameEvent"),i=r(e("AvailablePositionsHelper")),o=r(e("TargetPuzzleHelper")),a=r(e("CellGameField"));function r(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{cellPrefab:{default:null,type:cc.Prefab},gridMatrixSize:new cc.Size,dividerSize:0,_grid:{default:[],serializable:!1},_arrayTargetPuzzles:{default:[],serializable:!1},_currentTargetPuzzle:null,_oldTargetPuzzles:null},onEnable:function(){this._createGrid(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!0)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](n.GameEvent.CREATE_TARGET_PUZZLE,this.onCreateTargetPuzzle,this),cc.systemEvent[t](n.GameEvent.PUZZLE_CAPTURED,this.onPuzzleCaptured,this),cc.systemEvent[t](n.GameEvent.PUZZLE_RELEASED,this.onPuzzleReleased,this),cc.systemEvent[t](n.GameEvent.PUZZLE_MOVE,this.onPuzzleMove,this)},_createGrid:function(){for(var e=0;e<this.gridMatrixSize.width;e++){this._grid.push([]);for(var t=0;t<this.gridMatrixSize.height;t++){var n=cc.instantiate(this.cellPrefab),i=n.getComponent(a.default),o=cc.v2(-this.node.width/2+t*n.width+n.width/2+t*this.dividerSize,this.node.height/2-e*n.height-n.height/2-e*this.dividerSize);n.setPosition(o),n.parent=this.node,this._grid[e].push(i)}}},_getAvailablePositions:function(e){for(var t=null,n=null,o=[],a=0;a<this._grid.length-e.puzzle._grid.length+1;a++)for(var r=0;r<this._grid[a].length-e.puzzle._grid[0].length+1;r++){var c=[];t=this._grid[a][r];for(var s=!0,u=0;u<e.puzzle._grid.length;u++){for(var l=0;l<e.puzzle._grid[u].length;l++)if(n=this._grid[a+u][r+l],e.puzzle._grid[u][l].isBusy){if(this._grid[a+u][r+l].attachedNode){s=!1;break}c.push({i:a+u,j:r+l,block:e.puzzle._grid[u][l].node})}if(!s)break}if(s){var d=new i.default;d.arrIndex=c;var h=this._getCenterInGrid(t,n);d.positionCenterInWorld=this.node.convertToWorldSpaceAR(h),o.push(d)}}return o},_getCenterInGrid:function(e,t){return e.node===t.node?e.node.position:cc.v2((e.node.position.x+t.node.position.x)/2,(e.node.position.y+t.node.position.y)/2)},_createTargetPuzzle:function(e){var t=new o.default;return t.puzzle=e,t},_checkCombinations:function(){for(var e=this,t=0,i=[],o=0;o<this._grid.length;o++)this._grid[o].every(function(e){return e.attachedNode})&&(i.push(this._grid[o]),t++);for(var a=0;a<this._grid.length;a++){for(var r=!0,c=[],s=0;s<this._grid[a].length;s++){if(!this._grid[s][a].attachedNode){r=!1;break}c.push(this._grid[s][a])}r&&(i.push(c),t++)}for(var u=0;u<9;u++){for(var l=!0,d=[],h=3*Math.trunc(u/3);h<3*(Math.trunc(u/3)+1);h++){for(var p=u%3*3;p<3*(u%3+1);p++){if(!this._grid[h][p].attachedNode){l=!1;break}d.push(this._grid[h][p])}if(!l)break}l&&(i.push(d),t++)}var f=i.flat(),_=f.filter(function(e,t){return f.indexOf(e)===t});cc.log("\u043a\u043e\u043b-\u0432\u043e \u043a\u043e\u043c\u0431\u0438\u043d\u0430\u0446\u0438\u0439: "+t,"\u043a\u043e\u043b-\u0432\u043e \u043e\u0447\u043a\u043e\u0432: "+_.length*t),cc.systemEvent.emit(n.GameEvent.UPDATE_PLAYER_SCORE,_.length*t);var v=_.map(function(e){return e.attachedNode});_.forEach(function(e){e.attachedNode=null}),v.forEach(function(e){cc.tween(e).to(.1,{scale:0}).call(function(){e.active=!1}).start()}),this._arrayTargetPuzzles.forEach(function(t){var n=[].concat(e._getAvailablePositions(t));t.availablePositions=n});var E=this._grid.map(function(e){return e.map(function(e){return!!e.attachedNode})});cc.systemEvent.emit(n.GameEvent.UPDATE_PLAYER_GRID,E)},onCreateTargetPuzzle:function(e){var t=this._createTargetPuzzle(e);t.availablePositions=[].concat(this._getAvailablePositions(t)),this._arrayTargetPuzzles.push(t)},onPuzzleCaptured:function(e){this._currentTargetPuzzle=this._arrayTargetPuzzles.find(function(t){return t.puzzle.node===e.node})},onPuzzleMove:function(e){var t=this,n=e.node.parent.convertToWorldSpaceAR(e.node.position),i=this._currentTargetPuzzle.availablePositions.map(function(e){return e.positionCenterInWorld.sub(n).len()}),o=Math.min.apply(Math,i),a=i.indexOf(o);o<150?(this._currentTargetPuzzle.currentAvailablePositionIndex=a,this._currentTargetPuzzle.oldAvailablePositionIndex>-1&&this._currentTargetPuzzle.availablePositions[this._currentTargetPuzzle.oldAvailablePositionIndex].arrIndex.forEach(function(e){t._grid[e.i][e.j].toggleShadowBlock(!1)}),this._currentTargetPuzzle.availablePositions[a].arrIndex.forEach(function(e){t._grid[e.i][e.j].toggleShadowBlock(!0)}),e.targetPosition=this._currentTargetPuzzle.availablePositions[a].positionCenterInWorld,this._currentTargetPuzzle.oldAvailablePositionIndex=a):(this._currentTargetPuzzle.oldAvailablePositionIndex>-1&&this._currentTargetPuzzle.availablePositions[this._currentTargetPuzzle.oldAvailablePositionIndex].arrIndex.forEach(function(e){t._grid[e.i][e.j].toggleShadowBlock(!1)}),this._currentTargetPuzzle.currentAvailablePositionIndex=null,e.targetPosition=null)},onPuzzleReleased:function(e){var t=this;if(e.targetPosition){this._currentTargetPuzzle.availablePositions[this._currentTargetPuzzle.currentAvailablePositionIndex].arrIndex.forEach(function(e){t._grid[e.i][e.j].attachedNode=e.block,t._grid[e.i][e.j].toggleShadowBlock(!1)}),e.isPinned=!0;var i=this._arrayTargetPuzzles.findIndex(function(t){return t.puzzle.node===e.node});this._arrayTargetPuzzles.splice(i,1),cc.systemEvent.emit(n.GameEvent.PUZZLE_PINNED,e),this._checkCombinations()}this._currentTargetPuzzle.oldAvailablePositionIndex=-1,this._currentTargetPuzzle=null}}),cc._RF.pop()},{AvailablePositionsHelper:"AvailablePositionsHelper",CellGameField:"CellGameField",GameEvent:"GameEvent",TargetPuzzleHelper:"TargetPuzzleHelper"}],PuzzleInputCommand:[function(e,t,n){"use strict";var i;function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}cc._RF.push(t,"14122evetxIdbpZTWrqVKPX","PuzzleInputCommand"),n.__esModule=!0,n.default=void 0,e("GameEvent");var a=function(e){var t,n;function i(t){return e.call(this,t)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n);var a=i.prototype;return a.onDown=function(e,t,n){var i=e.getLocation(),o=cc.Camera.main.getScreenToWorldPoint(i);n.startMove(o)},a.onMove=function(e,t,n){var i=e.getLocation(),o=cc.Camera.main.getScreenToWorldPoint(i);n.move(o)},a.onUp=function(e,t,n){n.endMove()},i}(((i=e("IInputCommand"))&&i.__esModule?i:{default:i}).default);n.default=a,t.exports=n.default,cc._RF.pop()},{GameEvent:"GameEvent",IInputCommand:"IInputCommand"}],PuzzleStorage:[function(e,t){"use strict";cc._RF.push(t,"a5056hckVBLzpL6Gyo6pcIp","PuzzleStorage");var n=a(e("DataType")),i=e("GameEvent"),o=a(e("Puzzle"));function a(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{puzzlePrefab:{default:null,type:cc.Prefab},dataType:{default:n.default.None,type:n.default},_puzzleStorage:[]},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](i.GameEvent.PUZZLE_PINNED,this.onPuzzlePinned,this),cc.systemEvent[t](i.GameEvent.MATCH_START,this.onMatchStart,this),cc.systemEvent[t](i.GameEvent.SET_PUZZLES,this.onSetPuzzles,this)},_fillStorage:function(e){var t=this;e.forEach(function(n,i){var o=t._createPuzzle(n),a=cc.v2(t.node.width/e.length*i+t.node.width/e.length/2,0);o.setScale(.5),o.setPosition(a),o.parent=t.node,t._puzzleStorage.push(o)})},_createPuzzle:function(e){var t=cc.instantiate(this.puzzlePrefab);return t.getComponent(o.default).gridData=e,t},onPuzzlePinned:function(e){var t=this._puzzleStorage.findIndex(function(t){return t.node===e.node});this._puzzleStorage.splice(t,1),this._puzzleStorage.length||cc.systemEvent.emit(i.GameEvent.GET_PUZZLES)},onMatchStart:function(){cc.systemEvent.emit(i.GameEvent.GET_PUZZLES)},onSetPuzzles:function(e){this._fillStorage(e)}}),cc._RF.pop()},{DataType:"DataType",GameEvent:"GameEvent",Puzzle:"Puzzle"}],Puzzle:[function(e,t){"use strict";cc._RF.push(t,"75688xwI4BFZpH6a6RZs5Pl","Puzzle");var n,i=e("GameEvent"),o=(n=e("Cell"))&&n.__esModule?n:{default:n};cc.Class({extends:cc.Component,properties:{gridData:{default:[],visible:!1},inputCatcher:{default:null,type:cc.Node},blockPrefab:{default:null,type:cc.Prefab},cellPrefab:{default:null,type:cc.Prefab},dividerSize:5,offsetMove:cc.v2(),targetPosition:null,isPinned:!1,_oldParent:{default:null,serializable:!1},_oldScale:{default:null,serializable:!1},_oldPosition:{default:null,serializable:!1},_grid:{default:null,serializable:!1},_oldZIndex:0},onEnable:function(){this._init(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},startMove:function(e){if(!this.isPinned){this._oldParent=this.node.parent,this._oldPosition=this.node.position.clone(),this._oldScale=this.node.scale,this._oldZIndex=this.node.zIndex,this.node.zIndex=1;var t=this.node.parent.convertToNodeSpaceAR(e),n=cc.v2(t.x,t.y+300);this.node.setPosition(n),cc.tween(this.node).to(.1,{scale:1}).start(),cc.systemEvent.emit(i.GameEvent.PUZZLE_CAPTURED,this)}},move:function(e){if(!this.isPinned){var t=this.node.parent.convertToNodeSpaceAR(e),n=cc.v2(t.x,t.y+300);this.node.setPosition(n),cc.systemEvent.emit(i.GameEvent.PUZZLE_MOVE,this)}},endMove:function(){if(!this.isPinned){if(this.targetPosition){var e=this.node.parent.convertToNodeSpaceAR(this.targetPosition);this.node.setPosition(e),this.inputCatcher.active=!1}else this._returnStorage();this.node.zIndex=0,cc.systemEvent.emit(i.GameEvent.PUZZLE_RELEASED,this)}},_handleSubscription:function(){},_init:function(){var e=this._getCorrectSize();this.node.setContentSize(e),this._grid=this._createGrid(),cc.systemEvent.emit(i.GameEvent.CREATE_TARGET_PUZZLE,this)},_getCorrectSize:function(){return cc.Size(this.gridData[0].length*this.blockPrefab.data.width+(this.gridData[0].length-1)*this.dividerSize,this.gridData.length*this.blockPrefab.data.height+(this.gridData.length-1)*this.dividerSize)},_createGrid:function(){for(var e=this.gridData.map(function(e){return e.slice(0)}),t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++){var i=this._createCell(e[t][n]),o=i.getComponent("Cell"),a=cc.v2(-this.node.width/2+n*i.width+i.width/2+n*this.dividerSize,this.node.height/2-t*i.height-i.height/2-t*this.dividerSize);i.setPosition(a),i.parent=this.node,e[t][n]=o}return e},_createCell:function(e){var t=cc.instantiate(this.cellPrefab);return t.getComponent(o.default).isBusy=e,t},_returnStorage:function(){this.node.parent=this._oldParent,this.node.setPosition(this._oldPosition),cc.tween(this.node).to(.1,{scale:this._oldScale}).start()}}),cc._RF.pop()},{Cell:"Cell",GameEvent:"GameEvent"}],ScoreController:[function(e,t){"use strict";cc._RF.push(t,"5f0ddhtSqFDEYf6GpqU0P4s","ScoreController");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{updateScoreEvent:{default:n.GameEvent.NONE,type:n.GameEvent},scoreCounterText:{default:null,type:cc.RichText}},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](this.updateScoreEvent,this.onUpdateScore,this)},onUpdateScore:function(e){this.scoreCounterText.string=parseInt(this.scoreCounterText.string)+e+""}}),cc._RF.pop()},{GameEvent:"GameEvent"}],TargetPuzzleHelper:[function(e,t){"use strict";cc._RF.push(t,"24c50hzDzhF5ZJV47SthFF7","TargetPuzzleHelper"),cc.Class({name:"TargetPuzzleHelper",properties:{puzzle:null,availablePositions:[],oldAvailablePositionIndex:-1,currentAvailablePositionIndex:null}}),cc._RF.pop()},{}],TimerController:[function(e,t){"use strict";cc._RF.push(t,"483a7ZwO9RFoI9i7HIvqFlf","TimerController");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{updateTimerEvent:{default:n.GameEvent.NONE,type:n.GameEvent},timerText:{default:null,type:cc.RichText}},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](this.updateTimerEvent,this.onUpdateTimer,this)},onUpdateTimer:function(e){if(e>=0){var t=this.getFormattedTime(e);this.timerText.string=t}else cc.log("time ended")},getFormattedTime:function(e){var t=e/1e3,n=Math.trunc(t/60),i=Math.trunc(t-60*n);return n+":"+(i<10?"0"+i:i)}}),cc._RF.pop()},{GameEvent:"GameEvent"}]},{},["DataDictionary","DataType","GameEvent","MessageType","GameManager","IInputCommand","PuzzleInputCommand","InputDirection","InputType","InputCatcher","InputManager","NetworkManagerTS","Cell","CellGameField","CellGridPlayer","EnemyField","PlayerField","AvailablePositionsHelper","TargetPuzzleHelper","NameController","PuzzleStorage","Puzzle","ScoreController","TimerController"]);