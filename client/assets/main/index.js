window.__require=function e(t,n,i){function o(a,c){if(!n[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var u="function"==typeof __require&&__require;if(!c&&u)return u(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<i.length;a++)o(i[a]);return o}({AvailablePositionsHelper:[function(e,t){"use strict";cc._RF.push(t,"b6b74fa44VDXYuxG9zQdBFh","AvailablePositionsHelper"),cc.Class({properties:{positionCenterInWorld:cc.v2(),arrIndex:[]}}),cc._RF.pop()},{}],CellGameField:[function(e,t){"use strict";cc._RF.push(t,"a8aef+qqHxLL4c5ozVM9sTd","CellGameField"),cc.Class({extends:cc.Component,properties:{shadowBlock:{default:null,type:cc.Node},attachedNode:{default:null,type:cc.Node,visible:!1}},toggleShadowBlock:function(e){this.shadowBlock.active=e}}),cc._RF.pop()},{}],CellGridPlayer:[function(e,t){"use strict";cc._RF.push(t,"57baaUrdCxIbJnoFI4UevX3","CellGridPlayer"),cc.Class({extends:cc.Component,properties:{renderNode:{default:null,type:cc.Node},attachedNode:{default:null,type:cc.Node}}}),cc._RF.pop()},{}],Cell:[function(e,t){"use strict";cc._RF.push(t,"dd9eeVMruhC8bu6P/iUNPmT","Cell"),cc.Class({extends:cc.Component,properties:{renderNode:{default:null,type:cc.Node},renderLightNode:{default:null,type:cc.Node},renderDisableNode:{default:null,type:cc.Node},isBusy:{default:!1,notify:function(){this.renderNode.opacity=255*this.isBusy}}},toggleDisableCell:function(e){cc.log(e),this.renderDisableNode.active=e},toggleLightCell:function(e){this.renderLightNode.active=e}}),cc._RF.pop()},{}],DataDictionary:[function(e,t){"use strict";cc._RF.push(t,"8bacaIc0xxD7L2RC2wQamct","DataDictionary");var n,i=(n=e("DataType"))&&n.__esModule?n:{default:n},o=e("GameEvent");cc.Class({extends:cc.Component,properties:{PREVIEW:{default:!1,editorOnly:!0},dataType:{default:i.default.None,type:i.default,notify:function(){-1===this._convertDataType.indexOf(this.dataType)&&(this._convertDataType.push(this.dataType),this._data.push(null)),this.data=this._data[this._convertDataType.indexOf(this.dataType)]}},data:{default:null,type:cc.JsonAsset,notify:function(){this.dataType===i.default.None||null!==this.data&&!this.data||(this._data[this._convertDataType.indexOf(this.dataType)]=this.data)},visible:function(){return this.dataType!==i.default.None}},convertDataType:{get:function(){return this._convertDataType},type:[i.default],visible:function(){return this.PREVIEW}},_convertDataType:{default:function(){return[i.default.None]},type:[i.default]},_data:{default:function(){return[null]},type:[cc.JsonAsset]}},onLoad:function(){this._subscribeEvents(!0)},_subscribeEvents:function(e){var t=e?"on":"off";cc.systemEvent[t](o.GameEvent.GET_DATA,this.onGetData,this)},_getData:function(e){var t=this._convertDataType.indexOf(e);return-1!==t?this._data[t]:null},onGetData:function(e,t){var n=this._getData(e);t instanceof Function&&t(n)}}),cc._RF.pop()},{DataType:"DataType",GameEvent:"GameEvent"}],DataType:[function(e,t,n){"use strict";cc._RF.push(t,"1a8f4Kc8wxOE7veGVvJCjLp","DataType"),n.__esModule=!0,n.default=void 0;var i=cc.Enum({None:0,PuzzleGridData:1,GameFieldCombinations:2});n.default=i,t.exports=n.default,cc._RF.pop()},{}],EnemyField:[function(e,t){"use strict";cc._RF.push(t,"88071g2vXRC0IirXxrPovVj","EnemyField");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{cellPrefab:{default:null,type:cc.Prefab},_gridSize:cc.v2(9,9),_cellSize:new cc.Size(100,100),_dividerSize:5,_grid:[],arrayPossiblePosition:[]},onEnable:function(){this._createGrid(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](n.GameEvent.UPDATE_ENEMY_GRID,this.onUpdateEnemyGrid,this)},_createGrid:function(){this._grid=[];for(var e=0;e<this._gridSize.x;e++){this._grid.push([]);for(var t=0;t<this._gridSize.y;t++){var n=cc.instantiate(this.cellPrefab),i=n.getComponent("CellGridPlayer"),o=cc.v2(-this.node.width/2+t*n.width+n.width/2+t*this._dividerSize,this.node.height/2-e*n.height-n.height/2-e*this._dividerSize);n.parent=this.node,n.setPosition(o),this._grid[e].push(i)}}},onUpdateEnemyGrid:function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++)e[t][n]?this._grid[t][n].renderNode.opacity=255:this._grid[t][n].renderNode.opacity=0}}),cc._RF.pop()},{GameEvent:"GameEvent"}],GameEvent:[function(e,t,n){"use strict";cc._RF.push(t,"8be8d8L+t9PdI9Pis312ZTx","GameEvent"),n.__esModule=!0,n.GameEvent=void 0;var i=cc.Enum({NONE:0,INPUT:1,GET_DATA:2,PUZZLE_CAPTURED:3,PUZZLE_RELEASED:4,PUZZLE_MOVE:5,CREATE_TARGET_PUZZLE:6,PUZZLE_PINNED:7,UPDATE_PLAYER_SCORE:100,UPDATE_ENEMY_SCORE:101,GET_SCORE:102,SET_PLAYER_NAME:200,SET_ENEMY_NAME:201,UPDATE_TIMER:301,GET_PUZZLES:401,SET_PUZZLE:402,FILL_PUZZLE_STORAGE:403,UPDATE_PUZZLES_DATA_IN_STORAGE:404,UPDATE_PLAYER_GRID:501,UPDATE_ENEMY_GRID:502,GET_CENTER_IN_GRID:601,TOGGLE_SHADOW_BLOCKS:602,SHOW_RESULT:701,MATCH_START:1001,MATCH_END:1002,CHANGE_STATE_MATCH:1003,CONNECT_SOCKET:2001});n.GameEvent=i,cc._RF.pop()},{}],GameManager:[function(e,t){"use strict";cc._RF.push(t,"a4f1bk2Tw1MxJotUTosVzoU","GameManager");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{isEnableMultiTouch:!1,inputManager:{default:null,type:cc.Node},_gameSettings:{default:null,serializable:!1},_gameState:{default:!1,notify:function(e){e!==this._gameState&&this._changeGameState(this._gameState)}}},onEnable:function(){this._init(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](n.GameEvent.CHANGE_STATE_MATCH,this.onChangeStateMatch,this)},_init:function(){cc.macro.ENABLE_MULTI_TOUCH=this.isEnableMultiTouch},_changeGameState:function(e){e?this._matchStart():this._matchFinish()},_matchStart:function(){this.inputManager.active=!0},_matchFinish:function(){cc.log("_matchFinish"),cc.systemEvent.emit(n.GameEvent.GET_SCORE,function(e){cc.systemEvent.emit(n.GameEvent.SHOW_RESULT,e)}),this.inputManager.active=!1},onChangeStateMatch:function(e){this._gameState=e}}),cc._RF.pop()},{GameEvent:"GameEvent"}],IInputCommand:[function(e,t,n){"use strict";cc._RF.push(t,"a776431k/NCb70A4/vHibe9","IInputCommand"),n.__esModule=!0,n.default=void 0;var i=function(){function e(e){this.node=e.node,this.manager=e,this.touches=e.touches,this._currentTouch=null}var t=e.prototype;return t.onDown=function(){},t.onMove=function(){},t.onUp=function(){},t.createTouchInfo=function(e,t){var n={id:e._id,down:this.getTouchInfo(e,t),last:this.getTouchInfo(e,t),current:this.getTouchInfo(e,t)},i=this.touches.indexOf(null);return-1===i&&(i=this.touches.length,this.touches.push(null)),e.__id=i,this.touches[i]=n,n},t.refreshTouchInfo=function(e,t,n){e.last=e.current,e.current=this.getTouchInfo(t,n)},t.findTouch=function(e){return this.touches[e.__id]},t.destroyTouch=function(e){this.touches[e.__id]=null},t.getTouchInfo=function(e){var t=e.getLocation(),n=t.clone(),i=cc.Camera.main.getScreenToWorldPoint(e.getLocation());return n=this.node.convertToNodeSpaceAR(i),{time:this.manager.time,location:t,position:n,worldPosition:i}},e}();n.default=i,t.exports=n.default,cc._RF.pop()},{}],InputCatcher:[function(e,t){"use strict";cc._RF.push(t,"81046i4gF1AmYsU/Ln73WAB","InputCatcher");var n=e("GameEvent"),i=s(e("InputDirection")),o=s(e("InputType"));function s(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{direction:{default:i.default.None,type:i.default,tooltip:"\u043c\u0435\u0441\u0442\u043e \u043e\u0442\u043a\u0443\u0434\u0430 \u043f\u0440\u0438\u0448\u0435\u043b \u0438\u043d\u043f\u0443\u0442, \u043f\u043e \u044d\u043d\u0430\u043c\u0443 InputDirection"},target:{default:null,type:cc.Component,tooltip:"\u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u0430 \u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u0443. \u0412 \u043a\u043e\u043c\u0430\u043d\u0434\u0435 \u043c\u043e\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0435 \u043c\u0435\u0442\u043e\u0434\u044b"},analyticsArea:""},editor:{menu:"Input/InputCatcher"},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";this.node[t](cc.Node.EventType.TOUCH_START,this.onDown,this),this.node[t](cc.Node.EventType.TOUCH_MOVE,this.onMove,this),this.node[t](cc.Node.EventType.TOUCH_END,this.onUp,this),this.node[t](cc.Node.EventType.TOUCH_CANCEL,this.onUp,this)},onDown:function(e){cc.systemEvent.emit(n.GameEvent.INPUT,o.default.Down,this.direction,e.touch,this,this.target)},onMove:function(e){cc.systemEvent.emit(n.GameEvent.INPUT,o.default.Move,this.direction,e.touch,this,this.target)},onUp:function(e){cc.systemEvent.emit(n.GameEvent.INPUT,o.default.Up,this.direction,e.touch,this,this.target)}}),cc._RF.pop()},{GameEvent:"GameEvent",InputDirection:"InputDirection",InputType:"InputType"}],InputDirection:[function(e,t,n){"use strict";cc._RF.push(t,"0e72cf2IpJFD5WUnkNsAV5v","InputDirection"),n.__esModule=!0,n.default=void 0;var i=cc.Enum({None:0,Puzzle:1});n.default=i,t.exports=n.default,cc._RF.pop()},{}],InputManager:[function(e,t){"use strict";cc._RF.push(t,"1d252+ECVNH8pgkI9is40hr","InputManager");var n=e("GameEvent"),i=a(e("InputDirection")),o=a(e("InputType")),s=a(e("PuzzleInputCommand"));function a(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{commands:{default:{},visible:!1,serializable:!1},_isFirstTap:{default:!0,serializable:!1},_isInput:{default:!1,serializable:!1}},editor:{menu:"Input/InputManager"},onLoad:function(){this._handleSubscription(!0),this.commands[i.default.Puzzle]=new s.default(this)},_handleSubscription:function(){cc.systemEvent.on(n.GameEvent.INPUT,this.onInput,this)},onInput:function(e,t,n,i,s){var a=this.commands[t];switch(e){case o.default.Down:a&&a.onDown(n,i,s),this._isInput=!0;break;case o.default.Move:a&&a.onMove(n,i,s);break;case o.default.Up:a&&(a.onUp(n,i,s),this._isInput=!1)}},onDown:function(){},onMove:function(){},onUp:function(){}}),cc._RF.pop()},{GameEvent:"GameEvent",InputDirection:"InputDirection",InputType:"InputType",PuzzleInputCommand:"PuzzleInputCommand"}],InputType:[function(e,t,n){"use strict";cc._RF.push(t,"a55f9VtZXtG9asuWKjwRLgJ","InputType"),n.__esModule=!0,n.default=void 0;var i=cc.Enum({None:0,Down:1,Move:2,Up:3,Cancel:4});n.default=i,t.exports=n.default,cc._RF.pop()},{}],MessageType:[function(e,t,n){"use strict";cc._RF.push(t,"1cfd9ojXuJG7qkZA+aErSqD","MessageType"),n.__esModule=!0,n.MessageTypes=void 0;var i=Object.freeze({UPDATE_PLAYER_GRID:"updatePlayerGrid",UPDATE_ENEMY_GRID:"updateEnemyGrid",UPDATE_PLAYER_SCORE:"updatePlayerScore",UPDATE_ENEMY_SCORE:"updateEnemyScore",FILL_PUZZLE_STORAGE:"fillPuzzleStorage",UPDATE_MATCH_TIME:"updateMatchTime",CHANGE_MATCH_STATE:"changeMatchState",UPDATE_PUZZLES_DATA_IN_STORAGE:"updatePuzzlesDataInStorage",SET_PUZZLE:"setPuzzle",JOIN_OR_CREATE_ROOM:"joinOrCreate"});n.MessageTypes=i,cc._RF.pop()},{}],NameController:[function(e,t){"use strict";cc._RF.push(t,"9fdb0fgxqdIN5PlrcUaPgCA","NameController");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{setEventName:{default:n.GameEvent.NONE,type:n.GameEvent},nameText:{default:null,type:cc.RichText}},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](this.setEventName,this.onSetName,this)},onSetName:function(e){this.nameText.string=e}}),cc._RF.pop()},{GameEvent:"GameEvent"}],NetworkManagerTS:[function(e,t,n){"use strict";cc._RF.push(t,"2a960quGthNbIsO4TKeIsVq","NetworkManagerTS");var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(s<3?o(a):s>3?o(t,n,a):o(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Enums/GameEvent.js"),c=cc._decorator,r=c.ccclass,u=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hostName="localhost",t.port="3000",t}return o(t,e),t.prototype.start=function(){this.settingsGame=this._getSettingsGame(),this.client=new WebSocket("ws://"+this.hostName+":"+this.port),this._handleSubscription(!0),this._handleSubscriptionSocket()},t.prototype._handleSubscription=function(e){var t=e?"on":"off";cc.systemEvent[t](a.GameEvent.SET_PUZZLE,this.onSetPuzzle,this)},t.prototype._handleSubscriptionSocket=function(){var e=this;this.client.onopen=function(t){e.onOpen(t)},this.client.onmessage=function(t){e.onMessage(t)},this.client.onerror=function(t){e.onError(t)},this.client.onclose=function(t){e.onClose(t)}},t.prototype._changeStateMatch=function(e){cc.systemEvent.emit(a.GameEvent.CHANGE_STATE_MATCH,e.state)},t.prototype._updateMatchTime=function(e){cc.systemEvent.emit(a.GameEvent.UPDATE_TIMER,e.time)},t.prototype._fillPuzzleStorage=function(e){console.log(e),cc.systemEvent.emit(a.GameEvent.FILL_PUZZLE_STORAGE,e.puzzlesData)},t.prototype._updateEnemyGrid=function(e){cc.systemEvent.emit(a.GameEvent.UPDATE_ENEMY_GRID,e.grid)},t.prototype._updatePlayerGrid=function(e){cc.systemEvent.emit(a.GameEvent.UPDATE_PLAYER_GRID,e.grid)},t.prototype._updatePlayerScore=function(e){cc.systemEvent.emit(a.GameEvent.UPDATE_PLAYER_SCORE,e.score)},t.prototype._updateEnemyScore=function(e){cc.systemEvent.emit(a.GameEvent.UPDATE_ENEMY_SCORE,e.score)},t.prototype._getSettingsGame=function(){return{playerID:document.body.dataset.player_id,roomID:document.body.dataset.room_id,battleID:document.body.dataset.battle_id}},t.prototype._joinOrCreateRoom=function(){if(this.client.readyState===WebSocket.OPEN){var e={type:"joinOrCreate",params:{playerID:this.settingsGame.playerID,battleID:this.settingsGame.battleID}};this.client.send(JSON.stringify(e))}else console.log("socket suck!!!")},t.prototype._updatePuzzlesDataInStorage=function(e){console.log(e),cc.systemEvent.emit(a.GameEvent.UPDATE_PUZZLES_DATA_IN_STORAGE,e.puzzlesData)},t.prototype.getFormattedPuzzleForSend=function(e){return e._grid.map(function(e){return e.map(function(e){return!!e.isBusy})})},t.prototype.onMessage=function(e){var t=JSON.parse(e.data),n=t.type,i=t.params;switch(n){case"updateMatchTime":this._updateMatchTime(i);break;case"changeMatchState":this._changeStateMatch(i),console.log("changeMatchState",i);break;case"fillPuzzleStorage":this._fillPuzzleStorage(i),console.log("fillPuzzleStorage",i);break;case"updatePuzzlesDataInStorage":this._updatePuzzlesDataInStorage(i),console.log("_updatePuzzlesDataInStorage",i);break;case"updatePlayerGrid":this._updatePlayerGrid(i),console.log("_updatePlayerGrid",i);break;case"updatePlayerScore":this._updatePlayerScore(i),console.log("_updatePlayerScore",i);break;case"updateEnemyScore":this._updateEnemyScore(i),console.log("_updateEnemyScore",i);break;case"updateEnemyGrid":this._updateEnemyGrid(i),console.log("updateEnemyGrid",i);break;default:console.warn("Type: "+n+" unknown")}},t.prototype.onError=function(e){console.log("error",e)},t.prototype.onClose=function(e){console.log("close",e)},t.prototype.onOpen=function(e){console.log("open",e),this._joinOrCreateRoom()},t.prototype.onUpdatePlayerGrid=function(e){if(this.client.readyState===WebSocket.OPEN){var t={type:"grid",params:{array:e}};this.client.send(JSON.stringify(t))}else console.log("socket suck!!!")},t.prototype.onSetPuzzle=function(e){if(this.client.readyState===WebSocket.OPEN){var t={type:"setPuzzle",params:{puzzle:e}};this.client.send(JSON.stringify(t))}else console.log("socket suck!!!")},s([u],t.prototype,"hostName",void 0),s([u],t.prototype,"port",void 0),s([r],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../Enums/GameEvent.js":"GameEvent"}],PlayerField:[function(e,t){"use strict";cc._RF.push(t,"7a3deOKTo9MC6cso2surHO+","PlayerField");var n=e("GameEvent"),i=(o(e("TargetPuzzleHelper")),o(e("CellGameField")));function o(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{cellPrefab:{default:null,type:cc.Prefab},gridMatrixSize:new cc.Size,dividerSize:0,_grid:{default:[],serializable:!1}},onEnable:function(){this._createGrid(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!0)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](n.GameEvent.PUZZLE_PINNED,this.onPuzzlePinned,this),cc.systemEvent[t](n.GameEvent.UPDATE_PLAYER_GRID,this.onUpdatePlayerGrid,this),cc.systemEvent[t](n.GameEvent.GET_CENTER_IN_GRID,this.onGetCenterInGrid,this),cc.systemEvent[t](n.GameEvent.TOGGLE_SHADOW_BLOCKS,this.onToggleShadowBlocks,this)},_createGrid:function(){for(var e=0;e<this.gridMatrixSize.width;e++){this._grid.push([]);for(var t=0;t<this.gridMatrixSize.height;t++){var n=cc.instantiate(this.cellPrefab),o=n.getComponent(i.default),s=cc.v2(-this.node.width/2+t*n.width+n.width/2+t*this.dividerSize,this.node.height/2-e*n.height-n.height/2-e*this.dividerSize);n.setPosition(s),n.parent=this.node,this._grid[e].push(o)}}},onGetCenterInGrid:function(e,t,n){var i,o=this.node.convertToWorldSpaceAR(this._grid[e.i][e.j].node.position),s=this.node.convertToWorldSpaceAR(this._grid[t.i][t.j].node.position);i=e.i===t.i&&e.j===t.j?o:cc.v2((o.x+s.x)/2,(o.y+s.y)/2),"function"==typeof n&&n(i)},onToggleShadowBlocks:function(e,t){var n=this;e.flat().forEach(function(e){return e.isEmpty&&n._grid[e.i][e.j].toggleShadowBlock(t)})},onPuzzlePinned:function(e){var t=this;e._grid.forEach(function(n,i){n.forEach(function(n,o){if(n.isBusy){var s=e._currentNearestPossiblePosition.possiblePosition[i][o];t._grid[s.i][s.j].attachedNode=n.node}})})},onUpdatePlayerGrid:function(e){var t=this;e.forEach(function(e,n){e.forEach(function(e,i){!e&&t._grid[n][i].attachedNode&&cc.tween(t._grid[n][i].attachedNode).to(.1,{scale:0}).call(function(){t._grid[n][i].attachedNode.active=!1,t._grid[n][i].attachedNode=null}).start()})})}}),cc._RF.pop()},{CellGameField:"CellGameField",GameEvent:"GameEvent",TargetPuzzleHelper:"TargetPuzzleHelper"}],PuzzleInputCommand:[function(e,t,n){"use strict";var i;function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}cc._RF.push(t,"14122evetxIdbpZTWrqVKPX","PuzzleInputCommand"),n.__esModule=!0,n.default=void 0,e("GameEvent");var s=function(e){var t,n;function i(t){return e.call(this,t)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,o(t,n);var s=i.prototype;return s.onDown=function(e,t,n){var i=e.getLocation(),o=cc.Camera.main.getScreenToWorldPoint(i);n.startMove(o)},s.onMove=function(e,t,n){var i=e.getLocation(),o=cc.Camera.main.getScreenToWorldPoint(i);n.move(o)},s.onUp=function(e,t,n){n.endMove()},i}(((i=e("IInputCommand"))&&i.__esModule?i:{default:i}).default);n.default=s,t.exports=n.default,cc._RF.pop()},{GameEvent:"GameEvent",IInputCommand:"IInputCommand"}],PuzzleStorage:[function(e,t){"use strict";cc._RF.push(t,"a5056hckVBLzpL6Gyo6pcIp","PuzzleStorage");var n=s(e("DataType")),i=e("GameEvent"),o=s(e("Puzzle"));function s(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{puzzlePrefab:{default:null,type:cc.Prefab},dataType:{default:n.default.None,type:n.default},_puzzleStorage:[]},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](i.GameEvent.PUZZLE_PINNED,this.onPuzzlePinned,this),cc.systemEvent[t](i.GameEvent.FILL_PUZZLE_STORAGE,this.onFillPuzzleStorage,this),cc.systemEvent[t](i.GameEvent.UPDATE_PUZZLES_DATA_IN_STORAGE,this.onUpdatePuzzlesDataInStorage,this)},_fillStorage:function(e){var t=this;cc.warn("fill storage",e),e.forEach(function(n,i){var o=t._formattingPossiblePositions(n.possiblePositions),s=t._createPuzzle(n.gridData,o),a=cc.v2(t.node.width/e.length*i+t.node.width/e.length/2,0);s.setScale(.5),s.setPosition(a),s.parent=t.node,t._puzzleStorage.push(s)})},_createPuzzle:function(e,t){var n=cc.instantiate(this.puzzlePrefab),i=n.getComponent(o.default);return i.gridData=e,i.possiblePositions=t,n},_findPuzzleInStorage:function(e){var t=this;return this._puzzleStorage.map(function(e){return e.getComponent(o.default)}).find(function(n){return t._isEqualGrid(n.gridData,e)})},_isEqualGrid:function(e,t){return e.length===t.length&&e[0].length===t[0].length&&e.every(function(e,n){return e.every(function(e,i){return e===t[n][i]})})},_formattingPossiblePositions:function(e){return e.map(function(e){var t=e[0][0],n=e[e.length-1][e[e.length-1].length-1],o=null;return cc.systemEvent.emit(i.GameEvent.GET_CENTER_IN_GRID,t,n,function(e){o=e}),{possiblePosition:e,positionInGrid:o}})},onPuzzlePinned:function(e){var t=this._puzzleStorage.findIndex(function(t){return t===e.node});cc.log("delete puzzle "+t),this._puzzleStorage.splice(t,1)},onFillPuzzleStorage:function(e){this._fillStorage(e)},onUpdatePuzzlesDataInStorage:function(e){var t=this;e.forEach(function(n){var i=t._findPuzzleInStorage(n.gridData);if(i){console.log("find puzzle",i);var o=t._formattingPossiblePositions(n.possiblePositions);i.possiblePositions=o,i.checkPossiblePositions()}else console.log("puzzle not found",e)})}}),cc._RF.pop()},{DataType:"DataType",GameEvent:"GameEvent",Puzzle:"Puzzle"}],Puzzle:[function(e,t){"use strict";cc._RF.push(t,"75688xwI4BFZpH6a6RZs5Pl","Puzzle");var n,i=e("GameEvent"),o=(n=e("Cell"))&&n.__esModule?n:{default:n};cc.Class({extends:cc.Component,properties:{gridData:{default:[],visible:!1},inputCatcher:{default:null,type:cc.Node},blockPrefab:{default:null,type:cc.Prefab},cellPrefab:{default:null,type:cc.Prefab},dividerSize:5,offsetMove:cc.v2(),targetPosition:null,isPinned:!1,possiblePositions:{default:null,visible:!1},_oldParent:{default:null,serializable:!1},_oldScale:{default:null,serializable:!1},_oldPosition:{default:null,serializable:!1},_grid:{default:null,serializable:!1},_oldZIndex:0,_currentNearestPossiblePosition:null,_isActive:{default:!0,notify:function(e){e!==this._isActive&&(this.inputCatcher.active=this._isActive,this._toggleDisableCells(!this._isActive))}},_isCapture:{default:!1,notify:function(e){e!==this._isCapture&&this._toggleLightCells(this._isCapture)}}},onEnable:function(){this._init(),this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},startMove:function(e){if(!this.isPinned){this._isCapture=!0,this._oldParent=this.node.parent,this._oldPosition=this.node.position.clone(),this._oldScale=this.node.scale,this._oldZIndex=this.node.zIndex,this.node.zIndex=1;var t=this.node.parent.convertToNodeSpaceAR(e),n=cc.v2(t.x,t.y+300);this.node.setPosition(n),cc.tween(this.node).to(.1,{scale:1}).start()}},move:function(e){if(!this.isPinned){var t=this.node.parent.convertToNodeSpaceAR(e),n=cc.v2(t.x,t.y+300);this.node.setPosition(n);var o=this._findNearestPossiblePosition();o&&this._currentNearestPossiblePosition&&this._currentNearestPossiblePosition.positionInGrid!==o.positionInGrid&&(cc.systemEvent.emit(i.GameEvent.TOGGLE_SHADOW_BLOCKS,this._currentNearestPossiblePosition.possiblePosition,!1),cc.systemEvent.emit(i.GameEvent.TOGGLE_SHADOW_BLOCKS,o.possiblePosition,!0)),!o&&this._currentNearestPossiblePosition&&cc.systemEvent.emit(i.GameEvent.TOGGLE_SHADOW_BLOCKS,this._currentNearestPossiblePosition.possiblePosition,!1),o&&!this._currentNearestPossiblePosition&&cc.systemEvent.emit(i.GameEvent.TOGGLE_SHADOW_BLOCKS,o.possiblePosition,!0),this._currentNearestPossiblePosition=o}},endMove:function(){if(!this.isPinned){if(this._isCapture=!1,this._currentNearestPossiblePosition){var e=this.node.parent.convertToNodeSpaceAR(this._currentNearestPossiblePosition.positionInGrid);cc.tween(this.node).to(.1,{position:e}).start(),this.inputCatcher.active=!1,cc.systemEvent.emit(i.GameEvent.TOGGLE_SHADOW_BLOCKS,this._currentNearestPossiblePosition.possiblePosition,!1),cc.systemEvent.emit(i.GameEvent.PUZZLE_PINNED,this),cc.systemEvent.emit(i.GameEvent.SET_PUZZLE,{gridData:this.gridData,positionInGameField:this._currentNearestPossiblePosition.possiblePosition})}else this._returnStorage();this.node.zIndex=0}},updatePossiblePositions:function(e){this.possiblePositions=e},checkPossiblePositions:function(){this._isActive=!!this.possiblePositions.length},_handleSubscription:function(){},_init:function(){var e=this._getCorrectSize();this.node.setContentSize(e),this._grid=this._createGrid(),this.checkPossiblePositions()},_getCorrectSize:function(){return cc.Size(this.gridData[0].length*this.blockPrefab.data.width+(this.gridData[0].length-1)*this.dividerSize,this.gridData.length*this.blockPrefab.data.height+(this.gridData.length-1)*this.dividerSize)},_toggleDisableCells:function(e){cc.warn(this,"wtf?"),this._grid.forEach(function(t){return t.forEach(function(t){return t.isBusy&&t.toggleDisableCell(e)})})},_toggleLightCells:function(e){this._grid.forEach(function(t){return t.forEach(function(t){return t.isBusy&&t.toggleLightCell(e)})})},_createGrid:function(){for(var e=this.gridData.map(function(e){return e.slice(0)}),t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++){var i=this._createCell(e[t][n]),o=i.getComponent("Cell"),s=cc.v2(-this.node.width/2+n*i.width+i.width/2+n*this.dividerSize,this.node.height/2-t*i.height-i.height/2-t*this.dividerSize);i.setPosition(s),i.parent=this.node,e[t][n]=o}return e},_createCell:function(e){var t=cc.instantiate(this.cellPrefab);return t.getComponent(o.default).isBusy=e,t},_returnStorage:function(){var e=this;this.node.parent=this._oldParent,this.node.setPosition(this._oldPosition),cc.tween(this.node).call(function(){return e.inputCatcher.active=!1}).to(.1,{scale:this._oldScale}).call(function(){return e.inputCatcher.active=!0}).start()},_findNearestPossiblePosition:function(){var e=this.node.convertToWorldSpaceAR(cc.v2()),t=this.possiblePositions.map(function(t){return t.positionInGrid.sub(e).len()}),n=Math.min.apply(Math,t),i=t.indexOf(n);return n<150?this.possiblePositions[i]:null}}),cc._RF.pop()},{Cell:"Cell",GameEvent:"GameEvent"}],ScoreController:[function(e,t){"use strict";cc._RF.push(t,"5f0ddhtSqFDEYf6GpqU0P4s","ScoreController");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{updateScoreEvent:{default:n.GameEvent.NONE,type:n.GameEvent},getScoreEvent:{default:n.GameEvent.NONE,type:n.GameEvent},scoreCounterText:{default:null,type:cc.RichText}},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](this.updateScoreEvent,this.onUpdateScore,this),cc.systemEvent[t](this.getScoreEvent,this.onGetScore,this)},onUpdateScore:function(e){this.scoreCounterText.string=e+""},onGetScore:function(e){"function"==typeof e&&e(this.scoreCounterText.string)}}),cc._RF.pop()},{GameEvent:"GameEvent"}],Screen:[function(e,t){"use strict";cc._RF.push(t,"eec488ZusFAB64FIad01gL/","Screen"),cc.Class({extends:cc.Component,properties:{score:{default:null,type:cc.RichText},_timeTween:1},show:function(e){var t=this;cc.tween(this.node).call(function(){t.score.string=e,t.node.active=!0}).to(this._timeTween,{opacity:255}).start()},hide:function(){var e=this;cc.tween(this.node).to(0,{0:255}).call(function(){return e.node.active=!1}).start()}}),cc._RF.pop()},{}],TargetPuzzleHelper:[function(e,t){"use strict";cc._RF.push(t,"24c50hzDzhF5ZJV47SthFF7","TargetPuzzleHelper");var n,i=(n=e("AvailablePositionsHelper"))&&n.__esModule?n:{default:n};cc.Class({name:"TargetPuzzleHelper",properties:{puzzle:null,availablePositions:[],oldAvailablePositionIndex:-1,currentAvailablePositionIndex:null},updateAvailablePosition:function(){},calculateAvailablePosition:function(e){var t=this._getAvailablePosition(e);this.availablePositions=[].concat(t)},_getAvailablePosition:function(e){for(var t=null,n=null,o=[],s=(this.puzzle._grid.map(function(e){return e.map(function(e){return e.isBusy})}),0);s<e.length-this.puzzle._grid.length+1;s++)for(var a=0;a<e[s].length-this.puzzle._grid[0].length+1;a++){var c=this.puzzle._grid.map(function(e){return e.map(function(e){return e.isBusy})});t=e[s][a];for(var r=!0,u=0;u<this.puzzle._grid.length;u++){for(var l=0;l<this.puzzle._grid[u].length;l++){if(n=e[s+u][a+l],e[s+u][a+l].attachedNode&&this.puzzle._grid[u][l].isBusy){r=!1;break}this.puzzle._grid[u][l].isBusy&&(c[u][l]={i:s+u,j:a+l})}if(!r)break}if(r){var d=new i.default;d.arrIndex=c;var p=this._getCenterInGrid(t,n);d.positionCenterInWorld=e[0][0].node.parent.convertToWorldSpaceAR(p),o.push(d)}}return o},_getCenterInGrid:function(e,t){return e.node===t.node?e.node.position:cc.v2((e.node.position.x+t.node.position.x)/2,(e.node.position.y+t.node.position.y)/2)}}),cc._RF.pop()},{AvailablePositionsHelper:"AvailablePositionsHelper"}],TimerController:[function(e,t){"use strict";cc._RF.push(t,"483a7ZwO9RFoI9i7HIvqFlf","TimerController");var n=e("GameEvent");cc.Class({extends:cc.Component,properties:{updateTimerEvent:{default:n.GameEvent.NONE,type:n.GameEvent},timerText:{default:null,type:cc.RichText}},onEnable:function(){this._handleSubscription(!0)},onDisable:function(){this._handleSubscription(!1)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](this.updateTimerEvent,this.onUpdateTimer,this)},onUpdateTimer:function(e){if(e>=0){var t=this.getFormattedTime(e);this.timerText.string=t}else cc.log("time ended")},getFormattedTime:function(e){var t=e/1e3,n=Math.trunc(t/60),i=Math.trunc(t-60*n);return n+":"+(i<10?"0"+i:i)}}),cc._RF.pop()},{GameEvent:"GameEvent"}],UiManager:[function(e,t){"use strict";cc._RF.push(t,"bdb11XHl0VEUpntgESw7Hgq","UiManager");var n,i=(n=e("Screen"))&&n.__esModule?n:{default:n},o=e("GameEvent");cc.Class({extends:cc.Component,properties:{resultScreen:{default:null,type:i.default}},onLoad:function(){this._handleSubscription(!0)},_handleSubscription:function(e){var t=e?"on":"off";cc.systemEvent[t](o.GameEvent.SHOW_RESULT,this.onShowResult,this)},onShowResult:function(e){this.resultScreen.show(e)}}),cc._RF.pop()},{GameEvent:"GameEvent",Screen:"Screen"}]},{},["DataDictionary","DataType","GameEvent","MessageType","GameManager","IInputCommand","PuzzleInputCommand","InputDirection","InputType","InputCatcher","InputManager","NetworkManagerTS","UiManager","Screen","Cell","CellGameField","CellGridPlayer","EnemyField","PlayerField","AvailablePositionsHelper","TargetPuzzleHelper","NameController","PuzzleStorage","Puzzle","ScoreController","TimerController"]);